<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROSTOVANII CASINO - ADITA & YAKARI EDITION</title>
    <style>
        body {
            background: #050505; color: white; text-align: center;
            font-family: 'Arial Black', sans-serif; margin: 0; padding: 0;
            overflow: hidden; display: flex; flex-direction: column;
            align-items: center; min-height: 100vh;
        }

        /* --- SEMN LAS VEGAS --- */
        .vegas-sign {
            position: relative; display: inline-block; margin: 10px auto;
            padding: 10px 30px; background: #d00000; border: 4px solid #fff;
            border-radius: 100px / 50px; box-shadow: 0 0 20px #f00, inset 0 0 15px #000;
            z-index: 10;
        }
        .vegas-sign::before {
            content: ""; position: absolute; top: -8px; left: -8px; right: -8px; bottom: -8px;
            border: 3px dotted #ffd700; border-radius: 110px / 55px; animation: blink-lights 0.4s infinite;
        }
        @keyframes blink-lights { 0% { opacity: 1; } 50% { opacity: 0.2; } 100% { opacity: 1; } }

        .main-title {
            font-size: clamp(22px, 7vw, 45px); margin: 0; color: white;
            text-transform: uppercase; line-height: 1.1; text-shadow: 2px 2px 0 #000;
        }

        .machine {
            background: linear-gradient(180deg, #300 0%, #100 100%);
            padding: 15px; border-radius: 20px; display: inline-block;
            border: 4px solid #b8860b; box-shadow: 0 0 30px rgba(255, 0, 0, 0.6);
            margin-top: 5px; max-width: 95%; position: relative;
        }

        .reels-container {
            display: flex; gap: 8px; background: #000; padding: 8px;
            border-radius: 12px; border: 2px solid #444; justify-content: center;
        }

        .reel {
            width: clamp(75px, 25vw, 140px);
            height: clamp(225px, 60vh, 360px);
            position: relative; overflow: hidden; background: #111;
        }

        .reel-strip { position: absolute; width: 100%; display: flex; flex-direction: column; }
        .reel-strip img { 
            width: 100%; height: clamp(75px, 20vh, 120px); 
            object-fit: cover; border-bottom: 1px solid #222;
        }

        /* --- EFECTE SPECIALE --- */
        .win-glow {
            filter: brightness(1.5) contrast(1.2);
            box-shadow: inset 0 0 20px #ffd700;
            outline: 4px solid #ffd700; outline-offset: -4px;
            z-index: 10; animation: pulse-glow 0.4s infinite alternate;
        }
        @keyframes pulse-glow { from { transform: scale(1); } to { transform: scale(1.05); } }

        /* OVERLAY YAKARI & ADITA */
        #yakari-overlay, #adita-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; justify-content: center;
            align-items: center; z-index: 2000;
        }
        
        #adita-video { width: 90%; max-width: 1000px; border: 5px solid gold; box-shadow: 0 0 50px #ffd700; }

        #yakari-text {
            font-size: 14vw; color: #ff0000; text-shadow: 5px 5px 0 #fff, -5px -5px 20px #f00;
            font-weight: 900; animation: yakari-anim 0.2s infinite;
        }
        @keyframes yakari-anim {
            0% { transform: scale(1) rotate(3deg); }
            50% { transform: scale(1.3) rotate(-3deg); }
            100% { transform: scale(1) rotate(3deg); }
        }

        .controls { margin-top: 15px; width: 100%; }
        .bet-row { display: flex; justify-content: center; gap: 6px; margin-bottom: 10px; flex-wrap: wrap; }
        .balance-info { font-size: clamp(16px, 5vw, 24px); color: #0f0; font-weight: bold; }
        .free-spins-info { color: #ffd700; font-size: 20px; display: none; margin-top: 5px; }

        .bet-btn {
            background: #200; color: white; border: 2px solid #f00;
            padding: 8px 12px; cursor: pointer; border-radius: 8px; font-weight: bold;
        }
        .bet-btn.active { background: #ffd700; color: black; box-shadow: 0 0 10px #ffd700; }

        .spin-btn {
            font-size: clamp(22px, 6vw, 32px); padding: 12px 50px; cursor: pointer;
            border-radius: 50px; border: none; background: linear-gradient(#f00, #800);
            color: white; font-weight: 900; box-shadow: 0 4px 0 #400; text-transform: uppercase;
        }
        .spin-btn.free-mode { background: linear-gradient(#ffd700, #b8860b); color: #000; box-shadow: 0 4px 0 #540; }
        .spin-btn:disabled { opacity: 0.5; filter: grayscale(1); }

        #result { font-size: clamp(18px, 6vw, 35px); margin-top: 10px; min-height: 40px; font-weight: 900; }
        #canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1000; }
    </style>
</head>
<body>

<div id="yakari-overlay"><div id="yakari-text">YAKARIIIIIIII</div></div>
<div id="adita-overlay"><video id="adita-video" src="adita bani.mp4"></video></div>
<canvas id="canvas"></canvas>

<audio id="audio-win" src="win.wav" preload="auto"></audio>
<audio id="audio-spin" src="spin.mp3" preload="auto"></audio>
<audio id="audio-yakari" src="yakari.mp3" preload="auto"></audio>
<audio id="audio-adita-win" src="adita win.mp3" preload="auto"></audio>

<div class="vegas-sign">
    <div style="color: #ffd700; font-size: 11px; letter-spacing: 2px;">✦ WELCOME ✦</div>
    <h1 class="main-title">PROSTOVANII<br>CASINO</h1>
</div>

<div class="machine">
    <div class="reels-container">
        <div class="reel"><div id="strip1" class="reel-strip"></div></div>
        <div class="reel"><div id="strip2" class="reel-strip"></div></div>
        <div class="reel"><div id="strip3" class="reel-strip"></div></div>
    </div>

    <div class="controls">
        <div class="bet-row" id="bet-container">
            <button class="bet-btn active" onclick="setBet(50, this)">50 RON</button>
            <button class="bet-btn" onclick="setBet(100, this)">100 RON</button>
            <button class="bet-btn" onclick="setBet(250, this)">250 RON</button>
            <button class="bet-btn" onclick="setBet(500, this)">500 RON</button>
        </div>
        <div class="balance-info">BALANȚĂ: <span id="balance-val">10000</span> RON</div>
        <div id="fs-display" class="free-spins-info">ROTIRI GRATUITE: <span id="fs-count">0</span></div>
    </div>

    <button id="spin-btn" class="spin-btn" onclick="spin()">SPIN!</button>
    <div id="result"></div>
</div>

<script>
    let wallet = 10000;
    let currentBet = 50;
    let isSpinning = false;
    let freeSpins = 0;
    let audioUnlocked = false;
    let winSoundTimer;

    const symbols = [
        "speciala.jpg", "Image (3).jpg", "Image (4).jpg", 
        "Image (5).jpeg", "Image (6).jpeg", "Image (7).jpeg", "wild.jpg", "adita.jpg"
    ];
    const itemsCount = 60; 

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let moneyParticles = [];
    const sndWin = document.getElementById('audio-win');
    const sndSpin = document.getElementById('audio-spin');
    const sndYakari = document.getElementById('audio-yakari');
    const sndAdita = document.getElementById('audio-adita-win');

    function getSingleImgHeight() {
        const firstImg = document.querySelector('.reel-strip img');
        return firstImg ? firstImg.offsetHeight : 0;
    }

    function init() {
        document.querySelectorAll('.reel-strip').forEach(s => {
            s.innerHTML = '';
            for(let i=0; i<itemsCount; i++){
                let img = document.createElement('img');
                img.src = symbols[Math.floor(Math.random()*symbols.length)];
                s.appendChild(img);
            }
        });
        setTimeout(() => {
            const h = getSingleImgHeight();
            document.querySelectorAll('.reel-strip').forEach(s => {
                s.style.top = `-${(itemsCount - 3) * h}px`;
            });
        }, 200);
    }

    function setBet(v, b) {
        if(isSpinning || freeSpins > 0) return;
        currentBet = v;
        document.querySelectorAll('.bet-btn').forEach(x => x.classList.remove('active'));
        b.classList.add('active');
    }

    function stopAllSounds() {
        clearTimeout(winSoundTimer);
        [sndWin, sndYakari, sndSpin, sndAdita].forEach(s => {
            s.pause();
            s.currentTime = 0;
        });
    }

    function spin() {
        if(isSpinning) return;
        if(freeSpins === 0 && wallet < currentBet) return;
        stopAllSounds();
        document.querySelectorAll('img').forEach(img => img.classList.remove('win-glow'));
        
        if(!audioUnlocked) {
            [sndWin, sndSpin, sndYakari, sndAdita].forEach(track => {
                track.play().then(() => { track.pause(); track.currentTime = 0; }).catch(e => {});
            });
            audioUnlocked = true;
        }

        isSpinning = true;
        if(freeSpins > 0) {
            freeSpins--;
            updateFSDisplay();
        } else {
            wallet -= currentBet;
            document.getElementById('balance-val').innerText = wallet;
        }
        
        sndSpin.play().catch(e => {});
        const btn = document.getElementById('spin-btn');
        const res = document.getElementById('result');
        const imgH = getSingleImgHeight();
        btn.disabled = true;
        res.innerText = "NOROC...";

        let stopIndices = [];
        for(let i=1; i<=3; i++) {
            let s = document.getElementById('strip'+i);
            s.style.transition = "none";
            s.style.top = `-${(itemsCount - 3) * imgH}px`;
            s.offsetHeight; 
            let stopIdx = Math.floor(Math.random() * (itemsCount / 2)); 
            stopIndices.push(stopIdx);
            s.style.transition = `top ${1.2 + i * 0.3}s cubic-bezier(0.1, 0, 0.1, 1)`;
            s.style.top = `-${stopIdx * imgH}px`;
        }

        setTimeout(() => {
            sndSpin.pause();
            checkWin3x3(stopIndices);
            // Butonul se deblochează doar dacă nu rulează speciala Adita (gestionat în checkWin3x3)
        }, 2800);
    }

    function checkWin3x3(stopIndices) {
        const res = document.getElementById('result');
        const strips = [document.getElementById('strip1'), document.getElementById('strip2'), document.getElementById('strip3')];
        
        const matrix = [
            [strips[0].children[stopIndices[0]], strips[0].children[stopIndices[0]+1], strips[0].children[stopIndices[0]+2]],
            [strips[1].children[stopIndices[1]], strips[1].children[stopIndices[1]+1], strips[1].children[stopIndices[1]+2]],
            [strips[2].children[stopIndices[2]], strips[2].children[stopIndices[2]+1], strips[2].children[stopIndices[2]+2]]
        ];

        // 1. Verificare ADITA SCATTER (3 oriunde pe ecran)
        let aditaCount = 0;
        let aditaImages = [];
        for(let c=0; c<3; c++){
            for(let r=0; r<3; r++){
                let fileName = decodeURIComponent(matrix[c][r].src.split('/').pop());
                if(fileName === "adita.jpg"){
                    aditaCount++;
                    aditaImages.push(matrix[c][r]);
                }
            }
        }

        if(aditaCount >= 3){
            isSpinning = true;
            aditaImages.forEach(img => img.classList.add('win-glow'));
            wallet += currentBet * 100;
            document.getElementById('balance-val').innerText = wallet;
            res.innerText = "ADITA SCATTER WIN!";
            res.style.color = "#ffd700";
            triggerAditaVideo();
            return; // Oprește orice altă verificare (Yakari)
        }

        // 2. Verificare Linii Normale
        const paylines = [
            [matrix[0][0], matrix[1][0], matrix[2][0]], [matrix[0][1], matrix[1][1], matrix[2][1]], [matrix[0][2], matrix[1][2], matrix[2][2]],
            [matrix[0][0], matrix[1][1], matrix[2][2]], [matrix[0][2], matrix[1][1], matrix[2][0]]
        ];

        let totalWin = 0;
        let specialTriggered = false;

        paylines.forEach(line => {
            let names = line.map(img => decodeURIComponent(img.src.split('/').pop()));
            let nonWild = names.filter(n => n !== "wild.jpg");
            let base = nonWild.length > 0 ? nonWild[0] : "wild.jpg";

            if(base !== "adita.jpg" && names.every(n => n === base || n === "wild.jpg")) {
                let mult = 15;
                if(base === "speciala.jpg") { specialTriggered = true; mult = 150; }
                else if(base.includes("(4)") || base === "wild.jpg") { mult = 50; }
                totalWin += currentBet * mult;
                line.forEach(img => img.classList.add('win-glow'));
            }
        });

        if(specialTriggered) {
            triggerYakari();
        } else if(totalWin > 0) {
            sndWin.currentTime = 0; sndWin.play();
            winSoundTimer = setTimeout(() => { sndWin.pause(); }, 3000);
        }

        if(totalWin > 0) {
            wallet += totalWin;
            document.getElementById('balance-val').innerText = wallet;
            res.innerText = "CÂȘTIG: " + totalWin + " RON";
            res.style.color = "#ffd700";
            rainMoney();
        } else {
            res.innerText = freeSpins > 0 ? "DĂ-I YAKARI!" : "MAI BAGĂ O FISĂ!";
            res.style.color = "white";
        }

        // Finalizare rotire normală
        finishSpin();
    }

    function finishSpin() {
        isSpinning = false;
        document.getElementById('spin-btn').disabled = false;
        if(freeSpins > 0) setTimeout(spin, 1800);
    }

    function triggerAditaVideo() {
        stopAllSounds();
        const overlay = document.getElementById('adita-overlay');
        const video = document.getElementById('adita-video');
        const btn = document.getElementById('spin-btn');
        
        btn.disabled = true;
        overlay.style.display = 'flex';
        video.play();
        sndAdita.play();
        
        const closeAdita = () => {
            if(overlay.style.display === 'none') return; // Prevenire dublă execuție
            overlay.style.display = 'none';
            video.pause();
            video.currentTime = 0;
            finishSpin(); // Permite jocului să continue
        };

        video.onended = closeAdita;
        setTimeout(closeAdita, 10000); // Siguranță 10 secunde
    }

    function triggerYakari() {
        stopAllSounds(); sndYakari.play();
        const overlay = document.getElementById('yakari-overlay');
        overlay.style.display = 'flex';
        setTimeout(() => {
            overlay.style.display = 'none';
            freeSpins += 10;
            updateFSDisplay();
        }, 3000);
    }

    function updateFSDisplay() {
        const fsDisplay = document.getElementById('fs-display');
        const fsCount = document.getElementById('fs-count');
        const spinBtn = document.getElementById('spin-btn');
        const betContainer = document.getElementById('bet-container');
        if(freeSpins > 0) {
            fsDisplay.style.display = 'block';
            fsCount.innerText = freeSpins;
            spinBtn.classList.add('free-mode');
            spinBtn.innerText = "YAKARI SPIN";
            betContainer.style.opacity = "0.3";
        } else {
            fsDisplay.style.display = 'none';
            spinBtn.innerText = "SPIN!";
            spinBtn.classList.remove('free-mode');
            betContainer.style.opacity = "1";
        }
    }

    function rainMoney() {
        for(let i=0; i<100; i++) {
            moneyParticles.push({
                x: Math.random() * canvas.width, y: -50, w: 60, h: 30,
                speedY: 2 + Math.random() * 5, rot: Math.random() * 360,
                rotSpeed: (Math.random() - 0.5) * 10
            });
        }
    }

    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        moneyParticles.forEach((p, i) => {
            p.y += p.speedY; p.rot += p.rotSpeed;
            p.x += Math.sin(p.y / 30) * 2;
            ctx.save();
            ctx.translate(p.x, p.y); ctx.rotate(p.rot * Math.PI / 180);
            ctx.fillStyle = "#2e7d32"; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
            ctx.strokeStyle = "#fff"; ctx.strokeRect(-p.w/2, -p.h/2, p.w, p.h);
            ctx.fillStyle = "white"; ctx.font = "bold 18px Arial"; ctx.textAlign = "center";
            ctx.fillText("$", 0, 7);
            ctx.restore();
            if(p.y > canvas.height + 50) moneyParticles.splice(i, 1);
        });
        requestAnimationFrame(draw);
    }

    window.onload = () => {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        init(); draw();
    };
    window.onresize = () => {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    };
</script>
</body>
</html>
